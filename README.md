# Игра FLAPPYBIRD, суть игры - контролировать полёт птицы между рядами препятствий с помощь нажатия на кнопку.
Игра работает используя микрокнтроллер STM32F411 и светодиодную матрицу P10(32х16). Проект уже настроен и создан, необходимо только проделать шаги ниже.
1. Для запуска необходимо перенести две папки .metadata и lab5 в любую новую папку, например назовём её PROJECT.
2. В папке PROJECT переходим в папку lab5, для игры необходимо два основынх файла .cproject (Файл "CPROJECT") и lab5.ioc (STM32CubeMX).
3. Открыв файл lab5.ioc (STM32CubeMX) можно ознакомиться с настройками SPI1, TIM1 и распиновкой проекта.
4. Открыв файл .cproject (Файл "CPROJECT"), необходимо указать в WORKSPACE путь к папке PROJECT, в которой лежат наши две папки .metadata и lab5. После нажать 
   Launch и откроется сам проект, для запуска необходимо нажать Play(Зелёная треугольная кнопка вверху).
5. Для подключения матрицы и микроконтроллера необходимо ознакомиться с распиновкой в lab5.ioc (STM32CubeMX) и документацией на матрицу P10.
Ссылка на видео с игрой: https://disk.yandex.ru/i/mq95ybw6XNFtxA

# Изучение SPI
SPI (Serial Peripheral Interface) - последовательный синхронный стандарт передачи данных в режиме полного дуплекса, предназначенный для обеспечения простого и недорогого высокоскоростного сопряжения микроконтроллеров и периферии

Любая отладочная плата серии STM32 обладает возможностью реализаци подобного способа передачи данных.

Для осуществленя подключения необходимо использовать четыре провода для передачи данных. С их наименвоанием возникает множество вопросов, однако, есть свобданя таблица с осноными вариациями наименваония каналов, она представлена ниже.

![image](https://github.com/GreyRaccoon159/Flappy_Bird/assets/152299663/3b039fbb-b2ba-4d67-b678-f7371cfc2476)

Однако, в большинстве схем выделяют следующие наименование пинов:

• MOSI — выход ведущего, вход ведомого (англ. Master Out Slave In). Служит для передачи данных от ведущего устройства ведомому.

• MISO — вход ведущего, выход ведомого (англ. Master In Slave Out). Служит для передачи данных от ведомого устройства ведущему.

• SCLK или SCK— последовательный тактовый сигнал (англ. Serial Clock). Служит для передачи тактового сигнала для ведомых устройств.

• CS или SS — выбор микросхемы, выбор ведомого (англ. Chip Select, Slave Select).

• О процессе передачи данных

Сам же процесс передачи осуществляется последовательно, с формированием пакетов объёмом 1 байт ( 8 бит). Однако, бывают случаи, когда его объём уменьшается до 4 бит.

Общий принцип передачи данных изображён на рисунке ниже.

![image](https://github.com/GreyRaccoon159/Flappy_Bird/assets/152299663/4f045421-ac15-493a-8e0a-42049a094279)

Подлежащие передаче данные ведущее и ведомое устройства помещают в сдвиговые регистры. После этого ведущее устройство начинает генерировать импульсы синхронизации на линии SCLK, что приводит к взаимному обмену данными. Передача данных осуществляется бит за битом от ведущего по линии MOSI и от ведомого по линии MISO. Передача осуществляется, как правило, начиная со старших битов, но некоторые производители допускают изменение порядка передачи битов программными методами. После передачи каждого пакета данных ведущее устройство, в целях синхронизации ведомого устройства, может перевести линию SS в высокое состояние.

Приимущества метода передачи данных

Средняя скорость передачи данных
Возможность произвольного выбора длины пакета
Простая аппаратная реализация
Использованием лишь четырёх пинов
Максимальная тактовая частота ограничена лишь производительностью устройств
Недостатки метода передачи данных

Ведомое устройство не контралирует поток данных
Нет официальных стандартов (устрйоства не имеют сертефикацию)
Отсутвие "горячего" подключения устройств
Нет обратной связи от ведомого устройства (возможна передача данных в пустоту или с серьёзным искажением)

# Устройство LEDP10

Начнём с внешнего вида панели*, её вы можете наблюдать на изображении ниже

*Панель, представленная ниже, является версией с SMD светодиодами, с изображениями панели, на LED светодиодах можно ознакомиться в каталоге Additional files под хороший саундтрек (весь последющий текст идёт всё так же для LED версии панели, которая имеется у нас в лаборатории)

![image](https://github.com/GreyRaccoon159/Flappy_Bird/assets/152299663/ff2f5745-aeb6-46fe-8891-1f992e4c7615)

Вверху она показана в включённом состоянии, вниху же - в выключенном.

Итак, основные параметры данной панели можно выделить следующие:

Размер: 32 (длина) на 16 (высота) в светодиодах
Питающее напряжение: 5 вольт постоянного тока
Максимальное потребление тока: 4 ампера
Максимальная мощность: 20 Ватт
Это основные характеристики данной рабочей матрицы. Дальше рассмотрим обратную сторону панели*:

![image](https://github.com/GreyRaccoon159/Flappy_Bird/assets/152299663/f44ba25d-da5f-42ae-8664-b8c8c9a650c3)

Под цифрами обозначены различные узлы данной системы

SM74HC245D — неинвертирующий буфер (D17)
88SM74HC04 — 6-канальный инвертор
SM74HC138D — 8-битный дешифратор (D18)
PM4953 (4 еденицы) — сборка из 2 P-канальных MOSFET (VT1-VT4)
74HC595D (16 едениц) — сдвиговый регистр с защёлкой (D1-D16)
Два разъёма, подключение осуществлеяется через разъём 6.1, разъём 6.2 же необхдим для подключения следующей панели последовательно.

![image](https://github.com/GreyRaccoon159/Flappy_Bird/assets/152299663/a35acde2-8fdc-4a69-9ed3-853842453ab7)

Выше приведено изображение матрицы, с которой был реализован проект, с точки зрения компоновки есть отличия в детали 1. Что достаточно странно и не совсем понятно, так как все найденные схемы отличаются от того, что есть у нас.

Ниже приведено изображение, содержащее принципиальную схему устройства, по которой можно понять весь принцип работы данной панели. Однако эта схема акутальна для фотографии панели с хабра, но так как многие элементы аналогичны нашим, то можно сказать, что она вполне приминима к данной панели.

![image](https://github.com/GreyRaccoon159/Flappy_Bird/assets/152299663/04b5eab7-1b54-44cf-922d-3a86069b0e5f)

# Подключение к светодиодной матрице LEDP10

Подключение к матрице в рамках лабораторной работы будет осуществляться путём подключения сигнальных проводов от платы STM32 к специальному кабелю, установленному в крайний левый слот (его можно увидеть на изображении выше, он имеет набор пинов, окружённых чёрным корпусом)

Крайний правый порт нужен для последовательно подключения связки панелей.

Ниже приведён пример распиновки порта (а так же кабеля (так как он дублирует их)) относительно ключа (левая полоска, едва выходящая из контура кабеля).

![image](https://github.com/GreyRaccoon159/Flappy_Bird/assets/152299663/61fd1cc0-15bc-46f3-b9d4-764ab96bb972)

Рассмотрим назначение каждого из пинов

A и B - необходим для переключения между строками
OE - отвечает за запуск / отключение матрицы (с помощью ШИМ сигнала можно регулировать яркость (настоятельно рекомендую при длительной работе с матрицей))
SCK - канал для синхронизации частот работы переферии (подклчается к аналогичному пину на STM32)
MOSI - канал передачи данных (подклчается к аналогичному пину на STM32)
SCLK - канал подтверждения конца загрузки байта данных.
Если вы подключили всё правильно, всё перепроверили, но матрица так и не работает или работает с артефактами, то попробуйте подключить пины отзеркалено, это связано с тем, что один из кабелей меняет распиновку.
